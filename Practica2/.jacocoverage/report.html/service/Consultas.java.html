<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Consultas.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;Practica2&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">service</a> &gt; <span class="el_source">Consultas.java</span></div><h1>Consultas.java</h1><pre class="source lang-java linenums">package service;

import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.LinkedList;
import java.util.logging.Level;
import java.util.logging.Logger;
import models.Cita;
import models.Doctor;
import models.Paciente;
import models.ReporteModel;

<span class="fc" id="L17">public class Consultas {</span>
    
<span class="fc" id="L19">    private final String t_paciente = &quot;Paciente&quot;;</span>
    
    public boolean registrar(Connection connection, Paciente paciente){
        try{
            
            PreparedStatement consulta;
            
<span class="fc" id="L26">            consulta = connection.prepareStatement(&quot;INSERT INTO &quot;+ this.t_paciente </span>
                    +&quot;(nombre,telefono,direccion,fechanac,email,password) VALUES (?,?,?,?,?,?);&quot;);
            
<span class="fc" id="L29">            consulta.setString(1,paciente.getNombre());</span>
<span class="fc" id="L30">            consulta.setString(2,paciente.getTelefono());</span>
<span class="fc" id="L31">            consulta.setString(3,paciente.getDireccion());</span>
<span class="fc" id="L32">            consulta.setString(4,paciente.getFechanac());</span>
<span class="fc" id="L33">            consulta.setString(5,paciente.getEmail());</span>
<span class="fc" id="L34">            consulta.setString(6,paciente.getPassword());</span>
            
<span class="nc" id="L36">            consulta.executeUpdate();</span>
            
<span class="nc" id="L38">            return true;</span>
            
<span class="fc" id="L40">        } catch (SQLException ex) {</span>
<span class="fc" id="L41">            Logger.getLogger(Consultas.class.getName()).log(Level.SEVERE, null, ex);</span>
        }

<span class="fc" id="L44">        return false;</span>
    }
    
    
    public boolean login(Connection conexion, String email, String password) throws SQLException {
<span class="fc" id="L49">        int cont = 0;</span>

        try{
            
<span class="fc" id="L53">            PreparedStatement consulta = conexion.prepareStatement(&quot;SELECT email FROM &quot; + </span>
                    this.t_paciente + &quot; WHERE email = ? AND password = ?;&quot;);

<span class="fc" id="L56">            consulta.setString(1,email);</span>
<span class="fc" id="L57">            consulta.setString(2,password);</span>

<span class="fc" id="L59">            ResultSet resultado = consulta.executeQuery();</span>

<span class="pc bpc" id="L61" title="1 of 2 branches missed.">            while(resultado.next()){</span>
<span class="nc" id="L62">                cont++;</span>
               /*resultado.getInt(&quot;carnet&quot;)*/
            }
           
<span class="nc" id="L66">        }catch(SQLException ex){</span>
<span class="nc" id="L67">           throw new SQLException(ex);</span>
<span class="fc" id="L68">        }</span>
        
<span class="pc bpc" id="L70" title="1 of 2 branches missed.">        if(cont == 1)</span>
<span class="nc" id="L71">            return true;</span>
        
<span class="fc" id="L73">        return false;</span>
    }
    
    public LinkedList&lt;Doctor&gt; getDoctores(Connection conexion) throws SQLException{
<span class="fc" id="L77">        PreparedStatement consulta = conexion.prepareStatement( &quot;SELECT doc.iddoctor, doc.nombre, doc.telefono, esp.nombre\n&quot; +</span>
                                                                &quot;FROM Doctor doc, Especialidad esp\n&quot; +
                                                                &quot;WHERE doc.especialidad = esp.idespecialidad;&quot;);
<span class="fc" id="L80">        ResultSet res = consulta.executeQuery();</span>

<span class="fc" id="L82">        LinkedList&lt;Doctor&gt; doctores = new LinkedList&lt;&gt;();</span>
<span class="fc bfc" id="L83" title="All 2 branches covered.">        while(res.next()){</span>
<span class="fc" id="L84">            Doctor doctor = new Doctor();</span>
<span class="fc" id="L85">            doctor.setIddoctor(res.getInt(1));</span>
<span class="fc" id="L86">            doctor.setNombre(res.getNString(2));</span>
<span class="fc" id="L87">            doctor.setTelefono(res.getNString(3));</span>
<span class="fc" id="L88">            doctor.setEspecialidad(res.getNString(4));    </span>
<span class="fc" id="L89">            doctores.add(doctor);</span>
<span class="fc" id="L90">        }        </span>
<span class="fc" id="L91">        return doctores;</span>
    }
    
    
    public boolean crearCita(Connection connection, Cita cita){
        try{
            PreparedStatement consulta;                       
            
<span class="fc" id="L99">            consulta = connection.prepareStatement(&quot;INSERT INTO Cita(doctor,paciente,fecha,horainicio,horafin) VALUES (?,?,?,?,?)&quot;);</span>
            
<span class="fc" id="L101">            consulta.setInt(1,cita.getDoctor());</span>
<span class="fc" id="L102">            consulta.setInt(2,cita.getPaciente());</span>
<span class="fc" id="L103">            consulta.setDate(3,cita.getFecha());</span>
<span class="fc" id="L104">            consulta.setTime(4,cita.getHorainicio());</span>
<span class="fc" id="L105">            consulta.setTime(5,cita.getHorafin());</span>
                        
<span class="fc" id="L107">            consulta.executeUpdate();       </span>
            
            
            
<span class="nc" id="L111">        } catch (SQLException ex) {</span>
<span class="nc" id="L112">            ex.printStackTrace();</span>
<span class="nc" id="L113">            return false;</span>
<span class="fc" id="L114">        }</span>
        
<span class="fc" id="L116">        return true;</span>
        
    }
    
    /*MOD*/
    public Doctor getDoctorPorId(Connection conexion, int iddoctor) throws SQLException{
<span class="fc" id="L122">        PreparedStatement consulta = conexion.prepareStatement(&quot;SELECT doc.iddoctor, doc.nombre, doc.telefono, esp.nombre\n&quot; +</span>
                                                                &quot;FROM Doctor doc, Especialidad esp\n&quot; +
                                                                &quot;WHERE doc.especialidad = esp.idespecialidad AND doc.iddoctor=?;&quot;);
<span class="fc" id="L125">        consulta.setInt(1, iddoctor);</span>
<span class="fc" id="L126">        ResultSet res = consulta.executeQuery();</span>

<span class="fc" id="L128">        Doctor doctor = new Doctor();</span>
<span class="fc bfc" id="L129" title="All 2 branches covered.">        while(res.next()){</span>
<span class="fc" id="L130">            doctor.setIddoctor(res.getInt(1));</span>
<span class="fc" id="L131">            doctor.setNombre(res.getNString(2));</span>
<span class="fc" id="L132">            doctor.setTelefono(res.getNString(3));</span>
<span class="fc" id="L133">            doctor.setEspecialidad(res.getNString(4));</span>
        }
        
<span class="fc" id="L136">        return doctor;</span>
    }
    public Paciente getPacientePorId(Connection conexion, int idpaciente) throws SQLException{
<span class="fc" id="L139">        PreparedStatement consulta = conexion.prepareStatement(&quot;SELECT * FROM Paciente WHERE idpaciente=?;&quot;);</span>
<span class="fc" id="L140">        consulta.setInt(1, idpaciente);</span>
<span class="fc" id="L141">        ResultSet res = consulta.executeQuery();</span>

<span class="fc" id="L143">        Paciente paciente = new Paciente();</span>
<span class="fc bfc" id="L144" title="All 2 branches covered.">        while(res.next()){</span>
<span class="fc" id="L145">            paciente.setIdpaciente(res.getInt(&quot;idpaciente&quot;));</span>
<span class="fc" id="L146">            paciente.setNombre(res.getNString(&quot;nombre&quot;));</span>
<span class="fc" id="L147">            paciente.setTelefono(res.getNString(&quot;telefono&quot;));</span>
<span class="fc" id="L148">            paciente.setDireccion(res.getNString(&quot;direccion&quot;));</span>
<span class="fc" id="L149">            paciente.setFechanac(res.getDate(&quot;fechanac&quot;).toString());</span>
<span class="fc" id="L150">            paciente.setEmail(res.getNString(&quot;email&quot;));</span>
<span class="fc" id="L151">            paciente.setPassword(res.getNString(&quot;password&quot;));</span>
        }
        
<span class="fc" id="L154">        return paciente;</span>
    }
    
    public LinkedList&lt;Paciente&gt; getPacientes(Connection conexion) throws SQLException{
<span class="fc" id="L158">        PreparedStatement consulta = conexion.prepareStatement(&quot;SELECT * FROM Paciente;&quot;);</span>
<span class="fc" id="L159">        ResultSet res = consulta.executeQuery();</span>

<span class="fc" id="L161">        LinkedList&lt;Paciente&gt; pacientes = new LinkedList&lt;&gt;();</span>
<span class="fc bfc" id="L162" title="All 2 branches covered.">        while(res.next()){</span>
<span class="fc" id="L163">            Paciente paciente = new Paciente();</span>
<span class="fc" id="L164">            paciente.setIdpaciente(res.getInt(&quot;idpaciente&quot;));</span>
<span class="fc" id="L165">            paciente.setNombre(res.getNString(&quot;nombre&quot;));</span>
<span class="fc" id="L166">            paciente.setTelefono(res.getNString(&quot;telefono&quot;));</span>
<span class="fc" id="L167">            paciente.setDireccion(res.getNString(&quot;direccion&quot;));</span>
<span class="fc" id="L168">            paciente.setFechanac(res.getDate(&quot;fechanac&quot;).toString());</span>
<span class="fc" id="L169">            paciente.setEmail(res.getNString(&quot;email&quot;));</span>
<span class="fc" id="L170">            paciente.setPassword(res.getNString(&quot;password&quot;));</span>
<span class="fc" id="L171">            pacientes.add(paciente);</span>
<span class="fc" id="L172">        }</span>
        
<span class="fc" id="L174">        return pacientes;</span>
    }
    
    public LinkedList&lt;Cita&gt; getCitas(Connection conexion) throws SQLException{
<span class="fc" id="L178">        PreparedStatement consulta = conexion.prepareStatement(&quot;SELECT * FROM Cita;&quot;);</span>
<span class="fc" id="L179">        ResultSet res = consulta.executeQuery();</span>

<span class="fc" id="L181">        LinkedList&lt;Cita&gt; citas = new LinkedList&lt;&gt;();</span>
<span class="fc bfc" id="L182" title="All 2 branches covered.">        while(res.next()){</span>
<span class="fc" id="L183">            Cita cita = new Cita();</span>
<span class="fc" id="L184">            cita.setIdcita(res.getInt(&quot;idcita&quot;));</span>
<span class="fc" id="L185">            cita.setDoctor(res.getInt(&quot;doctor&quot;));</span>
<span class="fc" id="L186">            cita.setPaciente(res.getInt(&quot;paciente&quot;));</span>
<span class="fc" id="L187">            cita.setFecha(res.getDate(&quot;fecha&quot;));</span>
<span class="fc" id="L188">            cita.setHorainicio(res.getTime(&quot;horainicio&quot;));</span>
<span class="fc" id="L189">            cita.setHorafin(res.getTime(&quot;horafin&quot;));</span>
<span class="fc" id="L190">            citas.add(cita);</span>
<span class="fc" id="L191">        }</span>
        
<span class="fc" id="L193">        return citas;</span>
    }
    
    public boolean modificarCita(Connection connection, Cita cita){
        try{
            PreparedStatement consulta;
<span class="fc" id="L199">            consulta = connection.prepareStatement(&quot;UPDATE Cita SET &quot;</span>
                    + &quot;doctor=?,paciente=?,fecha=?,horainicio=?,horafin=? WHERE idcita=?;&quot;);
            
<span class="fc" id="L202">            consulta.setInt(1,cita.getDoctor());</span>
<span class="fc" id="L203">            consulta.setInt(2,cita.getPaciente());</span>
<span class="fc" id="L204">            consulta.setDate(3,cita.getFecha());</span>
<span class="fc" id="L205">            consulta.setTime(4,cita.getHorainicio());</span>
<span class="fc" id="L206">            consulta.setTime(5,cita.getHorafin());</span>
<span class="fc" id="L207">            consulta.setInt(6, cita.getIdcita());</span>
<span class="fc" id="L208">            consulta.executeUpdate();</span>
<span class="fc" id="L209">            return true;</span>
<span class="nc" id="L210">        } catch (SQLException ex) {</span>
<span class="nc" id="L211">            ex.printStackTrace();</span>
<span class="nc" id="L212">            return false;</span>
        }
    }
    
    
    public Boolean Eliminar_Cita(Connection conexion,String id)throws SQLException
    {
       try {
<span class="nc" id="L220">            PreparedStatement consulta = conexion.prepareStatement(&quot;Delete * FROM Cita where idcita =  ?;&quot;);</span>
<span class="nc" id="L221">            consulta.setString(1,id);</span>
<span class="nc" id="L222">            consulta.executeUpdate();</span>
<span class="nc" id="L223">            return true;</span>
<span class="fc" id="L224">       } catch (Exception e) {</span>
<span class="fc" id="L225">           return false;</span>
       }
    }
    public LinkedList&lt;ReporteModel&gt; getReporte1(Connection conexion, String fecha) throws SQLException{
<span class="fc" id="L229">        String sql=&quot;&quot;;</span>
        PreparedStatement consulta;
<span class="fc" id="L231">        ResultSet res=null;</span>
        
<span class="pc bpc" id="L233" title="1 of 2 branches missed.">        if((fecha.equals(&quot;ok&quot;))){</span>
<span class="nc" id="L234">            sql=&quot;SELECT c.idcita as idcita, p.nombre as paciente, p.email as correo, d.nombre as doctor, c.fecha as fecha, c.horainicio as horainicio, c.horafin as horafin, e.nombre as esp \n&quot; +</span>
                                                                &quot;FROM Doctor d, Especialidad e,Paciente p, Cita c \n&quot; +
                                                                &quot;WHERE d.especialidad = e.idespecialidad AND d.iddoctor=c.doctor AND c.paciente=p.idpaciente &quot;+
                                                                &quot;;&quot;;
            
<span class="nc" id="L239">            consulta= conexion.prepareStatement(sql);</span>
<span class="nc" id="L240">            res = consulta.executeQuery();</span>
        }
        else {
<span class="fc" id="L243">            Date fechabuscar=Date.valueOf(fecha);</span>
<span class="fc" id="L244">            sql=&quot;SELECT c.idcita as idcita, p.nombre as paciente, p.email as correo, d.nombre as doctor, c.fecha as fecha, c.horainicio as horainicio, c.horafin as horafin, e.nombre as esp\n&quot; +</span>
                                                                &quot;FROM Doctor d, Especialidad e,Paciente p, Cita c \n&quot; +
                                                                &quot;WHERE d.especialidad = e.idespecialidad AND d.iddoctor=c.doctor AND c.paciente=p.idpaciente &quot;+
                                                                &quot;AND c.fecha=? ;&quot;;
            
<span class="fc" id="L249">            consulta= conexion.prepareStatement(sql);</span>
<span class="fc" id="L250">            consulta.setDate(1,fechabuscar);</span>
<span class="fc" id="L251">            res = consulta.executeQuery();</span>
            
        }
<span class="fc" id="L254">        LinkedList&lt;ReporteModel&gt; citas = new LinkedList&lt;&gt;();</span>
<span class="fc bfc" id="L255" title="All 2 branches covered.">        while(res.next()){</span>
<span class="fc" id="L256">            ReporteModel cita = new ReporteModel();</span>
<span class="fc" id="L257">            cita.setIdcita(res.getInt(&quot;idcita&quot;));</span>
<span class="fc" id="L258">            cita.setDoctor(res.getString(&quot;doctor&quot;));</span>
<span class="fc" id="L259">            cita.setPaciente(res.getString(&quot;paciente&quot;));</span>
<span class="fc" id="L260">            cita.setCorreo(res.getString(&quot;correo&quot;));</span>
<span class="fc" id="L261">            cita.setEspecialidad(res.getString(&quot;esp&quot;));</span>
<span class="fc" id="L262">            cita.setFecha(res.getDate(&quot;fecha&quot;));</span>
<span class="fc" id="L263">            cita.setHorainicio(res.getTime(&quot;horainicio&quot;));</span>
<span class="fc" id="L264">            cita.setHorafin(res.getTime(&quot;horafin&quot;));</span>
<span class="fc" id="L265">            citas.add(cita);</span>
<span class="fc" id="L266">        }</span>
        
<span class="fc" id="L268">        return citas;</span>
    }
    
    public LinkedList&lt;ReporteModel&gt; getReporte2(Connection conexion, int buscar, int tipo) throws SQLException{
        PreparedStatement consulta;
<span class="fc" id="L273">        ResultSet res=null;</span>
<span class="fc" id="L274">        String sql=&quot;&quot;;</span>
<span class="pc bpc" id="L275" title="1 of 2 branches missed.">        if(tipo==1){</span>
<span class="nc" id="L276">            sql=&quot;SELECT c.idcita as idcita, p.nombre as paciente, p.email as correo, d.nombre as doctor, c.fecha as fecha, c.horainicio as horainicio, c.horafin as horafin, e.nombre as esp \n&quot; +</span>
                                                                &quot;FROM Doctor d, Especialidad e,Paciente p, Cita c \n&quot; +
                                                                &quot;WHERE d.especialidad = e.idespecialidad AND d.iddoctor=c.doctor AND c.paciente=p.idpaciente &quot;+
                                                                &quot;AND c.paciente=? ;&quot;;
            
<span class="nc" id="L281">            consulta= conexion.prepareStatement(sql);</span>
<span class="nc" id="L282">            consulta.setInt(1,buscar);</span>
<span class="nc" id="L283">            res = consulta.executeQuery();</span>
        }
        else {
<span class="fc" id="L286">            sql=&quot;SELECT c.idcita as idcita, p.nombre as paciente, p.email as correo, d.nombre as doctor, c.fecha as fecha, c.horainicio as horainicio, c.horafin as horafin, e.nombre as esp\n&quot; +</span>
                                                                &quot;FROM Doctor d, Especialidad e,Paciente p, Cita c \n&quot; +
                                                                &quot;WHERE d.especialidad = e.idespecialidad AND d.iddoctor=c.doctor AND c.paciente=p.idpaciente &quot;+
                                                                &quot;AND c.doctor=? ;&quot;;
            
<span class="nc" id="L291">            consulta= conexion.prepareStatement(sql);</span>
<span class="nc" id="L292">            consulta.setInt(1,buscar);</span>
<span class="nc" id="L293">            res = consulta.executeQuery();</span>
            
        }
        

<span class="nc" id="L298">        LinkedList&lt;ReporteModel&gt; citas = new LinkedList&lt;&gt;();</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">        while(res.next()){</span>
<span class="nc" id="L300">            ReporteModel cita = new ReporteModel();</span>
<span class="nc" id="L301">            cita.setIdcita(res.getInt(&quot;idcita&quot;));</span>
<span class="nc" id="L302">            cita.setDoctor(res.getString(&quot;doctor&quot;));</span>
<span class="nc" id="L303">            cita.setPaciente(res.getString(&quot;paciente&quot;));</span>
<span class="nc" id="L304">            cita.setCorreo(res.getString(&quot;correo&quot;));</span>
<span class="nc" id="L305">            cita.setEspecialidad(res.getString(&quot;esp&quot;));</span>
<span class="nc" id="L306">            cita.setFecha(res.getDate(&quot;fecha&quot;));</span>
<span class="nc" id="L307">            cita.setHorainicio(res.getTime(&quot;horainicio&quot;));</span>
<span class="nc" id="L308">            cita.setHorafin(res.getTime(&quot;horafin&quot;));</span>
<span class="nc" id="L309">            citas.add(cita);</span>
<span class="nc" id="L310">        }</span>
        
<span class="nc" id="L312">        return citas;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>